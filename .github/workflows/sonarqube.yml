name: Build Process
on: 
  pull_request: 
    types: 
      - opened
      - synchronize
      - reopened
  push: 
    branches: 
      - dev 
jobs: 
  build: 
    name: Build
    runs-on: ubuntu-latest
    env:
      TWILIO_ACCOUNT_SID: "${{ secrets.TWILIO_ACCOUNT_SID }}"
      TWILIO_AUTH_TOKEN: "${{ secrets.TWILIO_AUTH_TOKEN }}"
      TWILIO_API_KEY: "${{ secrets.TWILIO_API_KEY }}"
      TWILIO_API_SECRET: "${{ secrets.TWILIO_API_SECRET }}"
      TWILIO_VERIFY_SID: "${{ secrets.TWILIO_VERIFY_SID }}"
      FIREBASE_DATABASE_URL: "${{ secrets.FIREBASE_DATABASE_URL }}"
      FIREBASE_TYPE: "${{ secrets.FIREBASE_TYPE }}"
      FIREBASE_PROJECT_ID: "${{ secrets.FIREBASE_PROJECT_ID }}"
      FIREBASE_PRIVATE_KEY_ID: "${{ secrets.FIREBASE_PRIVATE_KEY_ID }}"
      FIREBASE_PRIVATE_KEY: "${{ secrets.FIREBASE_PRIVATE_KEY }}"
      FIREBASE_CLIENT_EMAIL: "${{ secrets.FIREBASE_CLIENT_EMAIL }}"
      FIREBASE_CLIENT_ID: "${{ secrets.FIREBASE_CLIENT_ID }}"
      FIREBASE_AUTH_URI: "${{ secrets.FIREBASE_AUTH_URI }}"
      FIREBASE_TOKEN_URI: "${{ secrets.FIREBASE_TOKEN_URI }}"
      FIREBASE_AUTH_PROVIDER_X509_CERT_URL: "${{ secrets.FIREBASE_AUTH_PROVIDER_X509_CERT_URL }}"
      FIREBASE_CLIENT_X509_CERT_URL: "${{ secrets.FIREBASE_CLIENT_X509_CERT_URL }}"
    steps: 
      - 
        uses: actions/checkout@v2
        with: 
          fetch-depth: 0
      
      - name: Install modules
        run: yarn install --ignore-engines
      - name: Run Test
        run: yarn test
      - 
        env: 
          SONAR_HOST_URL: "${{ secrets.SONAR_HOST_URL }}"
          SONAR_TOKEN: "${{ secrets.SONAR_TOKEN }}"
        uses: sonarsource/sonarqube-scan-action@master
      - 
        env: 
          SONAR_TOKEN: "${{ secrets.SONAR_TOKEN }}"
        timeout-minutes: 550
        uses: SonarSource/sonarqube-quality-gate-action@master
